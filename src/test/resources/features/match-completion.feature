# language: zh-TW
功能: 比賽完成管理
  作為一個網球比賽管理員
  我想要能夠正確判定比賽結束條件
  以便準確記錄比賽的最終結果

  背景:
    假設 我創建了一場比賽，球員為 "張三" 對戰 "李四"
    而且 比賽已經開始

  場景: 直落二獲勝 (2-0)
    假設 "張三" 以 "6-4" 贏得第 1 盤
    當 "張三" 以 "6-3" 贏得第 2 盤
    那麼 比賽應該結束
    而且 "張三" 應該是比賽獲勝者
    而且 比賽狀態應該是 "已完成"
    而且 最終盤數應該是 "2-0"
    而且 比賽完成時間應該被記錄

  場景: 三盤兩勝制獲勝 (2-1)
    假設 "張三" 以 "6-4" 贏得第 1 盤
    而且 "李四" 以 "7-5" 贏得第 2 盤
    當 "張三" 以 "6-2" 贏得第 3 盤
    那麼 比賽應該結束
    而且 "張三" 應該是比賽獲勝者
    而且 比賽狀態應該是 "已完成"
    而且 最終盤數應該是 "2-1"

  場景: 逆轉獲勝 (2-1)
    假設 "李四" 以 "6-3" 贏得第 1 盤
    而且 "張三" 以 "6-4" 贏得第 2 盤
    當 "張三" 以 "7-5" 贏得第 3 盤
    那麼 比賽應該結束
    而且 "張三" 應該是比賽獲勝者
    而且 最終盤數應該是 "2-1"

  場景: 搶七局決勝獲勝
    假設 "張三" 以 "6-4" 贏得第 1 盤
    而且 "李四" 以 "7-6" 贏得第 2 盤 (搶七局 7-5)
    當 "張三" 以 "7-6" 贏得第 3 盤 (搶七局 8-6)
    那麼 比賽應該結束
    而且 "張三" 應該是比賽獲勝者
    而且 最終盤數應該是 "2-1"

  場景: 比賽完成後無法繼續得分
    假設 "張三" 已經以 "2-0" 贏得比賽
    當 我嘗試為 "李四" 記錄得分
    那麼 系統應該拒絕記錄得分
    而且 應該顯示計分錯誤訊息 "比賽已結束，無法繼續得分"

  場景: 比賽完成後狀態查詢
    假設 "李四" 以 "2-1" 贏得比賽
    當 我查詢比賽狀態
    那麼 比賽狀態應該是 "已完成"
    而且 獲勝者應該是 "李四"
    而且 比賽完成時間應該存在
    而且 比賽創建時間應該早於完成時間

  場景: 比賽結果統計
    假設 "張三" 以 "6-4, 3-6, 6-2" 贏得比賽
    當 我查詢比賽統計
    那麼 "張三" 的盤數應該是 2
    而且 "李四" 的盤數應該是 1
    而且 "張三" 的總局數應該是 15
    而且 "李四" 的總局數應該是 12

  場景: 快速結束比賽 (6-0, 6-0)
    當 "張三" 以 "6-0" 贏得第 1 盤
    而且 "張三" 以 "6-0" 贏得第 2 盤
    那麼 比賽應該結束
    而且 "張三" 應該是比賽獲勝者
    而且 最終盤數應該是 "2-0"
    而且 比賽歷程應該記錄為 "6-0, 6-0"

  場景: 比賽完成事件發布
    假設 系統配置了事件發布器
    當 "張三" 以 "2-0" 贏得比賽
    那麼 應該發布 "比賽完成" 事件
    而且 事件應該包含獲勝者資訊
    而且 事件應該包含最終分數
    而且 事件應該包含比賽時長

  場景: 未完成比賽的狀態
    假設 "張三" 贏得第 1 盤
    而且 目前在第 2 盤進行中
    當 我查詢比賽狀態
    那麼 比賽狀態應該是 "進行中"
    而且 獲勝者應該是空值
    而且 比賽完成時間應該是空值

  場景: 比賽取消
    假設 比賽正在進行中
    而且 "張三" 已經贏得第 1 盤
    當 比賽被取消
    那麼 比賽狀態應該是 "已取消"
    而且 獲勝者應該是空值
    而且 比賽完成時間應該被記錄
    而且 取消後不能繼續得分

  場景: 比賽歷程記錄完整性
    假設 "李四" 以 "4-6, 6-3, 6-4" 贏得比賽
    當 我查詢完整比賽歷程
    那麼 應該記錄每一盤的詳細分數
    而且 應該記錄每一局的獲勝者
    而且 應該記錄比賽的關鍵時刻
    而且 應該記錄總比賽時長